<%= provide(:title, @event.name) %>

<div class="row">
  <div class="col-md-10 col-md-offset-1">
    <center><h1><%= @event.name %></h1></center>
    <center><h4><%= @event.local.name %></h4></center><br>

    <% if @event.picture? %>

      <div class="col-sm-4">
        <%= image_tag @event.picture.url, class: 'thumbnail' %>
      </div>
    
      <div class="col-sm-6">
        <p>Nome evento: <%= link_to @event.name, @event %><br>
        Nome locale: <%= link_to @event.local.name, @event.local %><br>
        Indirizzo: <%= @event.local.address %><br>
        Inizio: <%= @event.start.strftime("ore %H:%M del %d-%m-%y") %><br>
        Fine: <%= @event.end.strftime("ore %H:%M del %d-%m-%y") %><br>
        Descrizione: <%= @event.description %><br></p>

        
        <% if user_signed_in? %>
          <% if current_user==@event.local.user %>
            Categoria: <%= @event.local.category %><br>
            <div class="timestamp">
              Posted <%= time_ago_in_words(@event.created_at) %> ago
            </div>
        <% end 
        end %>
      </div>

      <div class="col-sm-2">
        <% if user_signed_in? %>
          <% if current_user==@event.local.user && current_user.role=='owner' %>
            <%= link_to 'Modifica', edit_event_path(@event), class: "edit-link" %><br>
            <%= link_to "Elimina", @event, method: :delete,
                                           data: { confirm: "Sei sicuro?" }, class: "delete-link" %>
          <% elsif current_user==@event.local.user%>
          <% elsif current_user.role == 'admin' %>
          <%= link_to "Elimina", @event, method: :delete,
                                           data: { confirm: "Sei sicuro?" }, class: "delete-link" %>
          <% else %>
            <div id="follow_form">
              <% if current_user.following_event?(@event) %>
                <%= form_for(current_user.active_event_relationships.find_by(followed_id: @event.id),
               html: { method: :delete }) do |f| %>
                  <%= f.submit "Segui già", data: { confirm: "Sei sicuro?" }, class: "unfollow-btn" %>
                <% end %>
              <% else %>
                <%= form_for(current_user.active_event_relationships.build) do |f| %>
                  <div><%= hidden_field_tag :followed_id, @event.id %></div>
                  <%= f.submit "Segui", class: "follow-btn" %>
                <% end %>
              <% end %>
            </div>
          <% end 
        end %>
        <% if current_user.role != 'admin' %>
        <span><img src="/assets/eye-icon.png" width="20px" height="20px">&nbsp;&nbsp;<%= @event.followers.count %></span>
        <br><br>
         Average rating <%= rating_for @event, 'stars', star: 5, disable_after_rate: false, half_show: true, enable_half: true, cancel: true, cancel_place: 'right', cancel_hint: 'Cancel this rating!', imbd_avg: true %>
        <br><br>
        <div id="fb-root"></div>
        <script>
          (function(d, s, id){
          var js, fjs = d.getElementsByTagName(s)[0];
          if (d.getElementById(id)) return;
          js = d.createElement(s); js.id = id;
          js.src = "//connect.facebook.net/it_IT/sdk.js#xfbml=1&version=v2.9";
          fjs.parentNode.insertBefore(js, fjs);
          }(document, 'script', 'facebook-jssdk'));

          

          //-------------NON CANCELLARE GLI SCRIPT E LA CLASS=FB-SHARE-BUTTON NEI COMMENTI----------------
          //------>>  ci serviranno dopo che saremo sul web con un nostro dominio per poter condividere gli eventi!!!!----------




          $(document).ready(function(){
            $(".fb-share-button").attr('data-href','https://www.ilmeteo.it/meteo/'+'Roma');
          })

          /*$(document).ready(function(){
            var name=document.title;
            $(".fb-share-button").attr('data-href','http://localhost:3000/events/'+name);
          })*/

          (function link(){
            return "https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fwww.ilmeteo.it%2Fmeteo%2FRoma&amp;src=sdkpreparse";
          })

          /*(function link(){
            var name=document.title;
            return "https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Flocalhost%3A3000%2Fevents%2F"+name+"&amp;src=sdkpreparse";
          })*/
        </script>

        <!--<div class="fb-share-button" data-href="" data-layout="button" data-size="small" data-mobile-iframe="false"> <a class="fb-xfbml-parse-ignore" target="_blank" href="javascript:link();">Share</a>
        </div>-->


        <div class="fb-share-button" data-href="" data-layout="button" data-size="small" data-mobile-iframe="false"> <a class="fb-xfbml-parse-ignore" target="_blank" href="javascript:link();">Share</a>
        </div>

        <% else %>
          <span>Segnalazioni</span>
        <% end %>
      </div>

    <% else %>

      <div class="col-sm-10">
        Nome evento: <%= link_to @event.name, @event %><br>
        Nome locale: <%= link_to @event.local.name, @event.local %><br>
        Indirizzo: <%= @event.local.address %><br>
        Inizio: <%= @event.start.strftime("ore %H:%M del %d-%m-%y") %><br>
        Fine: <%= @event.end.strftime("ore %H:%M del %d-%m-%y") %><br>
        Descrizione: <%= @event.description %><br>


        <% if user_signed_in? %>
          <% if current_user==@event.local.user %>
            Categoria: <%= @event.local.category %><br>
            <div class="timestamp">
              Posted <%= time_ago_in_words(@event.created_at) %> ago
            </div>
        <% end 
        end %>
      </div>

      <div class="col-sm-2">
        
        <% if user_signed_in? %>
          <% if current_user==@event.local.user && current_user.role=='owner' %>
            <%= link_to 'Modifica', edit_event_path(@event), class: "edit-link" %><br>
            <%= link_to "Elimina", @event, method: :delete,
                                           data: { confirm: "Sei sicuro?" }, class: "delete-link" %>
          <% elsif current_user==@event.local.user%>
          <% elsif current_user.role == 'admin' %>
          <%= link_to "Elimina", @event, method: :delete,
                                           data: { confirm: "Sei sicuro?" }, class: "delete-link" %>
          <% else %>
            <div id="follow_form">
              <% if current_user.following_event?(@event) %>
                <%= form_for(current_user.active_event_relationships.find_by(followed_id: @event.id),
               html: { method: :delete }) do |f| %>
                  <%= f.submit "Segui già", data: { confirm: "Sei sicuro?" }, class: "unfollow-btn" %>
                <% end %>
              <% else %>
                <%= form_for(current_user.active_event_relationships.build) do |f| %>
                  <div><%= hidden_field_tag :followed_id, @event.id %></div>
                  <%= f.submit "Segui", class: "follow-btn" %>
                <% end %>
              <% end %>
            </div>
          <% end 
        end %>
        <% if current_user.role != 'admin' %>
        <span><img src="/assets/eye-icon.png" width="20px" height="20px">&nbsp;&nbsp;<%= @event.followers.count %></span>
        <br><br>
         Average rating <%= rating_for @event, 'stars', star: 5, disable_after_rate: false, half_show: true, enable_half: true, cancel: true, cancel_place: 'right', cancel_hint: 'Cancel this rating!', imbd_avg: true %>
        <br><br>
        <div id="fb-root"></div>
        <script>
          (function(d, s, id){
          var js, fjs = d.getElementsByTagName(s)[0];
          if (d.getElementById(id)) return;
          js = d.createElement(s); js.id = id;
          js.src = "//connect.facebook.net/it_IT/sdk.js#xfbml=1&version=v2.9";
          fjs.parentNode.insertBefore(js, fjs);
          }(document, 'script', 'facebook-jssdk'));


          
          //-------------NON CANCELLARE GLI SCRIPT E LA CLASS=FB-SHARE-BUTTON NEI COMMENTI----------------
          //------>>  ci serviranno dopo che saremo sul web con un nostro dominio per poter condividere gli eventi!!!!----------



          $(document).ready(function(){
            $(".fb-share-button").attr('data-href','https://www.ilmeteo.it/meteo/'+'Roma');
          })

          /*$(document).ready(function(){
            var name=document.title;
            $(".fb-share-button").attr('data-href','http://localhost:3000/events/'+<%= @event.id %>);
          })*/

          (function link(){
            return "https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fwww.ilmeteo.it%2Fmeteo%2FRoma&amp;src=sdkpreparse";
          })

          /*(function link(ID){
            var name=document.title;
            return "https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Flocalhost%3A3000%2Fevents%2F"+ID+"&amp;src=sdkpreparse";
          })*/
        </script>

        <!--<div class="fb-share-button" data-href="" data-layout="button" data-size="small" data-mobile-iframe="false"> <a class="fb-xfbml-parse-ignore" target="_blank" href="javascript:link(<%= @event.id %>);">Share</a>
        </div>-->


        <div class="fb-share-button" data-href="" data-layout="button" data-size="small" data-mobile-iframe="false"> <a class="fb-xfbml-parse-ignore" target="_blank" href="javascript:link();">Share</a>
        </div>

        <% else %>
          <span>Segnalazioni</span>
        <% end %>
      </div>
    <% end %>
  </div>
</div>
<div class="row">
  <div class="col-md-6 col-md-offset-4">
    <%= commontator_thread(@event)%>
    
  </div>
</div>